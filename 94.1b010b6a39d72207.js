"use strict";(self.webpackChunklasquefaltaban=self.webpackChunklasquefaltaban||[]).push([[94],{4094:(G,g,o)=>{o.r(g),o.d(g,{UsersModule:()=>Y});var p=o(6895),u=o(343),b=o(549),x=o(5226),d=o.n(x),e=o(8256),h=o(529),v=o(3900),c=o(9646),U=o(262),T=o(9019),C=o(5657);let Z=(()=>{class r{constructor(t,s){this.http=t,this.cookieService=s,this.url=`${T.N.apiUrl}/user`,this.httpOptions={headers:new h.WM({"Content-Type":"application/json"})}}getUsers(){return this.http.get(this.url)}getUserById(t){return this.http.get(`${this.url}/${t}`,this.httpOptions)}deleteUser(t){return this.http.delete(`${this.url}/${t}`).pipe((0,v.w)(s=>(0,c.of)(!0)),(0,U.K)(s=>(0,c.of)(!1)))}editUser(t){const s=new FormData,i=new Blob([JSON.stringify(t)],{type:"application/json"});return s.append("updatedUser",i),this.http.put(`${this.url}/${t.username}`,s).pipe((0,v.w)(a=>(0,c.of)(!0)),(0,U.K)(a=>(0,c.of)(!1)))}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(h.eN),e.LFG(C.N))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var y=o(9298),A=o(419),l=o(433);const F=["updatedForm"];function w(r,n){1&r&&(e.TgZ(0,"span",22),e._uU(1," El nombre de usuario debe tener como m\xednimo 3 letras y como m\xe1ximo 30 "),e.qZA())}function M(r,n){1&r&&(e.TgZ(0,"span",22),e._uU(1," El nombre y apellidos deben tener como m\xednimo 4 letras y como m\xe1ximo 60 "),e.qZA())}function O(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"div",6),e._UZ(2,"span",7),e.qZA(),e.TgZ(3,"h3",8),e._uU(4,"Editar datos de usuario"),e.qZA(),e.TgZ(5,"form",9,10),e.NdJ("ngSubmit",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.editUser())}),e.TgZ(7,"div",11)(8,"label",12),e._uU(9,"Nombre de usuario"),e.qZA(),e._UZ(10,"input",13),e.YNc(11,w,2,0,"span",14),e.qZA(),e.TgZ(12,"div",11)(13,"label",15),e._uU(14,"Contrase\xf1a"),e.qZA(),e._UZ(15,"input",16),e.qZA(),e.TgZ(16,"div",11)(17,"label",17),e._uU(18,"Nombre y Apellidos"),e.qZA(),e._UZ(19,"input",18),e.YNc(20,M,2,0,"span",14),e.qZA(),e.TgZ(21,"div",11)(22,"label",19),e._uU(23,"Email"),e.qZA(),e._UZ(24,"input",20),e.qZA(),e.TgZ(25,"div",11)(26,"button",21),e._uU(27,"Editar"),e.qZA()()()()}if(2&r){const t=e.MAs(6),s=e.oxw();e.xp6(10),e.Q6J("ngModel",s.initForm.username),e.xp6(1),e.Q6J("ngIf",s.notValid("username")),e.xp6(4),e.Q6J("ngModel",s.initForm.password),e.xp6(4),e.s9C("value",s.user.name),e.Q6J("ngModel",s.initForm.fullname),e.xp6(1),e.Q6J("ngIf",s.notValid("fullname")),e.xp6(4),e.s9C("value",s.user.email),e.Q6J("ngModel",s.initForm.email),e.xp6(2),e.Q6J("disabled",t.invalid)}}let S=(()=>{class r{constructor(t,s,i,a){this.activatedRoute=t,this.usersService=s,this.authService=i,this.router=a,this.initForm={username:"",password:"",fullname:"",email:""},this.repassword="",this.json={username:"",name:"",email:"",password:""}}ngOnInit(){this.id=this.activatedRoute.snapshot.paramMap.get("id"),this.usersService.getUserById(this.id).subscribe({next:t=>{this.user=t,this.initForm.username=this.user.username,this.initForm.fullname=this.user.name,this.initForm.email=this.user.email}})}notValid(t){return this.updatedForm?.controls[t]?.invalid&&this.updatedForm?.controls[t]?.touched}getUser(){this.usersService.getUserById(this.id).subscribe({next:t=>{this.user=t}})}editUser(){this.json.username=this.updatedForm.value.username,this.json.name=this.updatedForm.value.fullname,this.json.email=this.updatedForm.value.email,this.json.password=this.updatedForm.value.password,this.usersService.editUser(this.json).subscribe({next:t=>{d().fire({icon:"success",title:"Usuario editado",confirmButtonColor:"#8d448b"}),this.authService.isAdminGuard()?this.router.navigate(["/user"]):this.router.navigate([""])},error:t=>{d().fire({icon:"error",title:"Usuario no editado",confirmButtonColor:"#8d448b"}),this.router.navigate(["/user"])}})}checkPassword(){return!(!this.updatedForm?.controls.repassword?.touched||!this.updatedForm?.controls.password?.touched)&&this.updatedForm?.controls.repassword.value!=this.updatedForm?.controls.password.value}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(u.gz),e.Y36(Z),e.Y36(y.e),e.Y36(u.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-update-user"]],viewQuery:function(t,s){if(1&t&&e.Gf(F,5),2&t){let i;e.iGM(i=e.CRH())&&(s.updatedForm=i.first)}},decls:7,vars:1,consts:[[1,"ftco-section"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-6","col-lg-7"],[1,"login-wrap","p-4","p-md-5"],[4,"ngIf"],[1,"icon","d-flex","align-items-center","justify-content-center"],[1,"fa","fa-user-o"],[1,"text-center","mb-4"],["autocomplete","off",1,"login-form",3,"ngSubmit"],["updatedForm","ngForm"],[1,"form-group"],["for","username",1,"col-form-label"],["type","text","name","username","minlength","3","maxlength","30","readonly","",1,"form-control","rounded-left",3,"ngModel"],["class","form-text text-danger",4,"ngIf"],["for","password",1,"col-form-label"],["type","password","name","password","minlength","5","maxlength","60",1,"form-control","rounded-left",3,"ngModel"],["for","fullname",1,"col-form-label"],["type","text","name","fullname","minlength","4","maxlength","60","required","",1,"form-control","rounded-left",3,"ngModel","value"],["for","email",1,"col-form-label"],["type","email","name","email","required","",1,"form-control","rounded-left",3,"ngModel","value"],["type","submit",1,"btn","btn-primary","rounded","submit","p-3","px-5",3,"disabled"],[1,"form-text","text-danger"]],template:function(t,s){1&t&&(e._UZ(0,"app-breadcrumb"),e.TgZ(1,"section",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),e.YNc(6,O,28,9,"div",5),e.qZA()()()()()),2&t&&(e.xp6(6),e.Q6J("ngIf",null!=s.user))},dependencies:[p.O5,A.L,l._Y,l.Fj,l.JJ,l.JL,l.Q7,l.wO,l.nD,l.On,l.F],encapsulation:2}),r})();var f=o(5415),J=o(7579),j=o(7500);function B(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td")(10,"button",9),e.NdJ("click",function(){const a=e.CHM(t).$implicit,m=e.oxw();return e.KtG(m.editUser(a.username,a.name,a.email,a.role))}),e.O4$(),e.TgZ(11,"svg",10),e._UZ(12,"path",11)(13,"path",12),e.qZA(),e._uU(14," Editar"),e.qZA(),e.kcU(),e.TgZ(15,"button",13),e.NdJ("click",function(){const a=e.CHM(t).$implicit,m=e.oxw();return e.KtG(m.deleteUser(a.username))}),e.O4$(),e.TgZ(16,"svg",14),e._UZ(17,"path",15),e.qZA(),e._uU(18," Borrar"),e.qZA()()()}if(2&r){const t=n.$implicit;e.xp6(2),e.Oqu(t.username),e.xp6(2),e.Oqu(t.email),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.role)}}const q=[{path:"",component:(()=>{class r{constructor(t,s,i){this.httpClient=t,this.usersService=s,this.router=i,this.dtOptions={},this.dtTrigger=new J.x,this.json={username:"",name:"",email:""},this.router.routeReuseStrategy.shouldReuseRoute=()=>!1}ngOnInit(){this.dtOptions={pagingType:"full_numbers",pageLength:10,processing:!0},this.usersService.getUsers().subscribe({next:t=>{this.users=t,this.dtTrigger.next(this.users)},error:t=>{}})}ngOnDestroy(){this.dtTrigger.unsubscribe()}deleteUser(t){this.usersService.deleteUser(t).subscribe({next:s=>{d().fire({icon:"success",title:"Usuario borrado",confirmButtonColor:"#8d448b"}).then(i=>{location.reload()})},error:s=>{d().fire({icon:"error",title:"Usuario no borrado",confirmButtonColor:"#8d448b"})}})}editUser(t,s,i,a){this.json.username=t,this.json.name=s,this.json.email=i,this.usersService.editUser(this.json).subscribe({next:m=>{d().fire({icon:"success",title:"Usuario editado",confirmButtonColor:"#8d448b"}),this.router.navigate(["/user"])},error:m=>{d().fire({icon:"error",title:"Usuario no editado",confirmButtonColor:"#8d448b"}),this.router.navigate(["/user"])}})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(h.eN),e.Y36(Z),e.Y36(u.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-userslist"]],viewQuery:function(t,s){if(1&t&&e.Gf(f.G,5),2&t){let i;e.iGM(i=e.CRH())&&(s.dtElement=i.first)}},decls:23,vars:3,consts:[[1,"container-fluid"],[1,"row"],[1,"col-2"],[1,"col-10","ms-sm-auto","px-md-4"],[1,"flex-shrink-0","position-sticky","text-center","align-top"],[1,"display-5","fw-bold","mb-5"],["datatable","",1,"table","table-bordered","table-striped","table-hover",3,"dtOptions","dtTrigger"],[1,"h4"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-info",2,"margin-left","10px",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil-square"],["d","M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"],["fill-rule","evenodd","d","M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"],["type","button",1,"btn","btn-danger",2,"margin-left","10px",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-trash3"],["d","M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"app-sidebar"),e.qZA(),e.TgZ(4,"main",3)(5,"div",4)(6,"h1",5),e._uU(7,"Listado de usuarios"),e.qZA(),e.TgZ(8,"table",6)(9,"thead")(10,"tr",7)(11,"th"),e._uU(12,"Nombre de usuario"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Email"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Nombre completo"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Rol"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Acciones"),e.qZA()()(),e.TgZ(21,"tbody"),e.YNc(22,B,19,4,"tr",8),e.qZA()()()()()()),2&t&&(e.xp6(8),e.Q6J("dtOptions",s.dtOptions)("dtTrigger",s.dtTrigger),e.xp6(14),e.Q6J("ngForOf",s.users))},dependencies:[p.sg,j.k,f.G],styles:["h1[_ngcontent-%COMP%]{color:#8d448b}"]}),r})(),pathMatch:"full",canActivate:[b._]},{path:"update/:id",component:S}];let N=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[u.Bz.forChild(q),u.Bz]}),r})();var E=o(4466),Q=o(4333);let Y=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[p.ez,N,E.m,l.u5,Q.JX,f.T,u.Bz]}),r})()}}]);